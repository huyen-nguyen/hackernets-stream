<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Stream graph</title>
    <script src="lib/d3.v4.min.js"></script>
</head>
<body>
<div id="mainContent"></div>
<script>
    let main = "#mainContent";
    let svg = d3.select(main)
        .append("div")
        .style("width", (width + margin.left + margin.right) + "px")
        .attr("id", "mainGraphContainer")
        .append("svg")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom);
    
    // main svg
    let g = svg.append("g")
        .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

    //Create the stack layout for the data
    const stack = d3.stack().keys(keyList)
        .offset(d3.stackOffsetNone);

    const stacks = stack(streamRawData);
    highestStack = stacks[stacks.length-1].map(d => {
        return {
            y: d[1],
            time: d.data.time
        }
    });
    //The scales
    xScale.domain([startDate, endDate]);
    yScale.domain(d3.extent(stacks.flat().flat()));

    //The x axis
    const xAxisGroup = g.append("g").attr("transform", "translate(0," + height + ")");
    const xAxis = d3.axisBottom(xScale);
    let xAxisNodes = xAxisGroup.call(xAxis);
    styleAxis(xAxisNodes);

    //The y Axis
    const yAxisGroup = g.append('g').attr('id','yAxis');
    const yAxis = d3.axisLeft(yScale);
    let yAxisNodes = yAxisGroup.call(yAxis);
    styleAxis(yAxisNodes);

    //The area function used to generate path data for the area.
    const areaGen = d3.area()
        .x(d => xScale(d.data.time))
        .y0(d => yScale(d[0]))
        .y1(d => yScale(d[1]))
        .curve(d3.curveMonotoneX);

    // Main stream
    g.append("g")
        .attr("id", "streamG")
        .selectAll(".layer")
        .data(stacks).enter()
        .append("path")
        .attr("class", "layer")
        .attr("d", areaGen)
        .attr("fill", (d, i) => {
            return taxonomy.find(d => d.id === keyList[i]).color;
        });

</script>
</body>
</html>